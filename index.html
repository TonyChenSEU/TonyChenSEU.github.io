
<script type="text/javascript"
        src="https://cdn.bitmovin.com/player/web/8/bitmovinplayer.js"></script>
<script type="text/javascript"
        src="https://cdn.bitmovin.com/analytics/web/beta/2/bitmovinanalytics.min.js"></script>

<div class="demo_form">
    <div class="row">
        <div class="col-md-4 adjust-pad-right mt-2">
            <select id="available-manifest-type" class="form-control">
                <option value='dash'>DASH</option>
                <option value='hls'>HLS</option>
                <option value='smooth'>Smooth</option>
            </select>
        </div>
        <div class="col-md-4 adjust-pad-left adjust-pad-right mt-2">
            <input id="manifest-in" type="text" class="form-control" placeholder="Manifest URL">
        </div>
        <div class="col-md-4 adjust-pad-left adjust-pad-right mt-2">
            <input id="licence-in" type="text" class="form-control" placeholder="License Server URL">
        </div>
    </div>
    <div class="row mt-3 mb-3">
        <div class="col-md-8 mt-2">
            <form class="detection" role="search">
                <span>Detected <span id="detected-browser"></span>, using</span>
                <select id="available-drm-systems" disabled>
                    <option value=''>No DRM</option>
                </select>
            </form>
        </div>
        <div class="col-md-4 adjust-pad-left adjust-pad-right">
            <input class="btn btn-success form-control" id="load-btn" value="Load" type="button">
        </div>
    </div>
    <div class="clear"></div>
</div>

<div class="row">
    <div class="col-lg-6 player-col">
        <div id="player" class="tv-frame">
            <div id="player-container"></div>
        </div>
    </div>
    <div class="col-lg-6 code-col">
<!--        ${code:demo.js}-->
<!--        <script  type="text/javascript" src="demo.js">-->
        <script  >
            var config = {
                key: '<YOUR PLAYER KEY>',
                cast: {
                    enable: true
                }
            };

            var source = {
                dash: 'https://cdn.bitmovin.com/content/assets/art-of-motion_drm/mpds/11331.mpd',
                hls: 'https://cdn.bitmovin.com/content/assets/art-of-motion_drm/m3u8s/11331.m3u8',
                smooth: 'https://test.playready.microsoft.com/smoothstreaming/SSWSS720H264/SuperSpeedway_720.ism/manifest',
                drm: {
                    widevine: {
                        LA_URL: 'https://cwip-shaka-proxy.appspot.com/no_auth'
                    },
                    playready: {
                        LA_URL: 'https://test.playready.microsoft.com/service/rightsmanager.asmx?PlayRight=1&ContentKey=EAtsIJQPd5pFiRUrV9Layw=='
                    }
                }
            };

        </script>
    </div>
</div>

<hr class="mt-5">

<!--<div class="row">-->
<!--<div class="col-12">-->
<!--<h3>Compatibility</h3>-->
<!--</div>-->
<!--</div>-->

<!--<div class="row mt-5">-->
<!--    <div class="col-lg-6">-->
<!--        <h4>Media Source Extension – MSE</h4>-->
<!--        <p>MSE is <span id="mse-supported"></span> by your current browser.</p>-->
<!--        <div class="code">-->
<!--            <ul id="mse-list">-->

<!--            </ul>-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="col-lg-6">-->
<!--        <h4>Encrypted Media Extension – EME</h4>-->
<!--        <p>EME is <span id="eme-supported"></span> by your current browser.</p>-->
<!--        <div class="code">-->
<!--            <ul id="eme-list">-->

<!--            </ul>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<hr class="mt-5">

<!--<div class="sdk-wrapper">-->
<!--    <div class="sdk-wrapper-header">-->
<!--        <h4 class="sdk-wrapper-title">Try our SDKs</h4>-->
<!--        <p class="sdk-wrapper-description">Bitmovin iOS SDK | Bitmovin Android SDK</p>-->
<!--    </div>-->
<!--    <div class="sdk-wrapper-body">-->
<!--        <div class="sdk-item">-->
<!--                <img src="https://bitmovin-a.akamaihd.net/webpages/demo-fw/stream-test/Apple.svg" />-->
<!--            <div class="sdk-item-content">-->
<!--                <div style="padding-bottom: 6px;">iOS/tvOS SDK</div>-->
<!--                <a target="_blank" onclick="amp.logSDKSourceCodeClicked('drm', 'ios')" href="https://github.com/bitmovin/bitmovin-player-ios-samples">-->
<!--                    <div style="height: 28px;" class="btn btn-sm btn-outline-dark">-->
<!--                        <i class="fa-brands fa-github"></i>-->
<!--                        <span class="pl-1">Check out the SDK</span>-->
<!--                    </div>-->
<!--                </a>-->
<!--            </div>-->
<!--            <a target="_blank" class="sdk-item-url" href="https://itunes.apple.com/us/app/bitmovin-player/id1245174386">-->
<!--                <img src="https://bitmovin-a.akamaihd.net/webpages/demo-fw/stream-test/Appstore.svg" />-->
<!--            </a>-->
<!--        </div>-->
<!--        <div class="sdk-item">-->
<!--            <img src="https://bitmovin-a.akamaihd.net/webpages/demo-fw/stream-test/Android.svg" />-->
<!--            <div class="sdk-item-content">-->
<!--                <div style="padding-bottom: 6px;">Android SDK</div>-->
<!--                <a target="_blank" onclick="amp.logSDKSourceCodeClicked('drm', 'android')" href="https://github.com/bitmovin/bitmovin-player-android-samples">-->
<!--                    <div style="height: 28px;" class="btn btn-sm btn-outline-dark">-->
<!--                        <i class="fa-brands fa-github"></i>-->
<!--                        <span class="pl-1">Check out the SDK</span>-->
<!--                    </div>-->
<!--                </a>-->
<!--            </div>-->
<!--            <a target="_blank" class="sdk-item-url" href="https://play.google.com/store/apps/details?id=com.bitmovin.demo.player">-->
<!--                <img src="https://bitmovin-a.akamaihd.net/webpages/demo-fw/stream-test/GooglePlay.svg" />-->
<!--            </a>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->
<div class="setup-code">
<!--    <script type="text/javascript" src="https://bitmovin.com/wp-includes/js/jquery/jquery.min.js?ver=3.7.1" id="jquery-core-js"></script>-->
<!--    <script type="text/javascript" src="https://bitmovin.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.1" id="jquery-migrate-js"></script>-->
<!--    <script  type="text/javascript" src="js/additionalDemoInformation.js"></script>-->
<!--    <script  type="text/javascript" src="js/browser.js">-->
    <script  >

        var BROWSER = {
            OPERA: 'OPERA',
            FIREFOX: 'FIREFOX',
            SAFARI: 'SAFARI',
            CHROME: 'CHROME',
            IE: 'IE',
            EDGE: 'EDGE',
            UNKNOWN: 'UNKNOWN',
        };

        var getBrowser = function () {
            // Opera 8.0+
            var isOpera = (!!window.opr && !!opr.addons) || !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;

            // Firefox 1.0+
            var isFirefox = typeof InstallTrigger !== 'undefined';

            // Safari 3.0+ "[object HTMLElementConstructor]"
            var isSafari =
                /constructor/i.test(window.HTMLElement) ||
                (function (p) {
                    return p.toString() === '[object SafariRemoteNotification]';
                })(!window['safari'] || safari.pushNotification);

            var isIosSafari = /Safari/i.test(navigator.userAgent) && /iP(hone|od|ad)/i.test(navigator.userAgent);

            // Internet Explorer 6-11
            var isIE = /*@cc_on!@*/ false || !!document.documentMode;

            // Edge 20+
            var isEdge = !isIE && /Edg/i.test(navigator.userAgent);

            // Chrome 1+
            var isChrome = /Google Inc/.test(navigator.vendor);

            var isChromeMobileAndroid = /Chrome/i.test(navigator.userAgent) && /android/i.test(navigator.userAgent);

            return isOpera
                ? BROWSER.OPERA
                : isFirefox
                    ? BROWSER.FIREFOX
                    : isSafari
                        ? BROWSER.SAFARI
                        : isIE
                            ? BROWSER.IE
                            : isEdge
                                ? BROWSER.EDGE
                                : isIosSafari
                                    ? BROWSER.SAFARI
                                    : isChrome || isChromeMobileAndroid
                                        ? BROWSER.CHROME
                                        : BROWSER.UNKNOWN;
        };

    </script>
<!--    <script  type="text/javascript" src="js/common.js"></script>-->
<!--    <script  type="text/javascript" src="js/script.js">-->
    <script  >
        (function () {

            var noDrmSource = {
                'dash': 'https://cdn.bitmovin.com/content/assets/art-of-motion-dash-hls-progressive/mpds/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.mpd',
                'hls': 'https://cdn.bitmovin.com/content/assets/art-of-motion-dash-hls-progressive/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8',
                'smooth': 'https://test.playready.microsoft.com/smoothstreaming/SSWSS720H264/SuperSpeedway_720.ism/manifest'
            };

            var defaultSource = {
                'hls': 'https://cdn.bitmovin.com/content/assets/art-of-motion_drm/m3u8s/11331.m3u8',
                'dash': 'https://cdn.bitmovin.com/content/assets/art-of-motion_drm/mpds/11331.mpd',
                'smooth': 'https://test.playready.microsoft.com/smoothstreaming/SSWSS720H264/SuperSpeedway_720.ism/manifest',
                'drm': {
                    'widevine': {
                        'LA_URL': 'https://cwip-shaka-proxy.appspot.com/no_auth'
                    },
                    'playready': {
                        'LA_URL': 'https://test.playready.microsoft.com/service/rightsmanager.asmx?PlayRight=1&ContentKey=EAtsIJQPd5pFiRUrV9Layw=='
                    }
                }
            };

            var keySystems = {
                'widevine': ['com.widevine.alpha'],
                'playready': ['com.microsoft.playready', 'com.youtube.playready'],
                'primetime': ['com.adobe.primetime', 'com.adobe.access'],
                'fairplay': ['com.apple.fps.1_0', 'com.apple.fps.2_0'],
                'wiseplay': ['com.wiseplay.drm'],
            };

            // force https, otherwise DRM would not work
            if (window.location.protocol !== 'https:' && window._rails_env === 'production') {
                window.location.protocol = 'https:';
            } else {
                console.warn('DRM will only work via https://. Will redirect in production. Current environment is: ' + window._rails_env);
            }

            var config = {
                key: '29ba4a30-8b5e-4336-a7dd-c94ff3b25f30',
                analytics: {
                    key: '45adcf9b-8f7c-4e28-91c5-50ba3d442cd4',
                    videoId: 'drm'
                },
                cast: {
                    enable: true
                },
                playback: {
                    muted: true
                }
            };

            var playerContainer = document.getElementById('player-container');
            var player = new bitmovin.player.Player(playerContainer, config);

            function getBrowserImage(selectedBrowser) {
                switch (selectedBrowser) {
                    case BROWSER.CHROME:
                        return '<i class="fa-brands fa-chrome" aria-hidden="true"></i>';
                    case BROWSER.EDGE:
                        return '<i class="fa-brands fa-edge" aria-hidden="true"></i>';
                    case BROWSER.FIREFOX:
                        return '<i class="fa-brands fa-firefox" aria-hidden="true"></i>';
                    case BROWSER.IE:
                        return '<i class="fa-brands fa-internet-explorer" aria-hidden="true"></i>';
                    case BROWSER.OPERA:
                        return '<i class="fa-brands fa-opera" aria-hidden="true"></i>';
                    case BROWSER.SAFARI:
                        return '<i class="fa-brands fa-safari" aria-hidden="true"></i>';
                    case BROWSER.UNKNOWN:
                    default:
                        return '<i class="fa-solid fa-circle-question" aria-hidden="true"></i>';
                }
            }

            document.getElementById('detected-browser').innerHTML = getBrowserImage(getBrowser());


            /**
             * Destroys any previous player instance and creates a new one with the given information
             *
             * @param drm 'widevine' | 'playready' | '' | null
             * @param manifestUrl the url to the manifest of the stream
             * @param licenceUrl  the URL to the licence server of the DRM System
             */
            function setupPlayer(drm, manifestUrl, licenceUrl, manifestType) {
                // clone config to avoid leftovers from previous calls
                var source = {};

                if (manifestUrl == null || manifestUrl === '') {
                    if (drm == null || drm == '') {
                        source[manifestType] = noDrmSource[manifestType];
                    } else {
                        source[manifestType] = defaultSource[manifestType];
                        source[drm] = defaultSource.drm;
                    }
                } else {
                    source = {};
                    source[manifestType] = manifestUrl;
                }

                if (drm != null && drm !== '' && defaultSource.drm[drm]) {
                    // If no licenceURL is provided use the one from the defaultSource for the given drm type
                    licenceUrl = (licenceUrl !== '') ? licenceUrl : defaultSource.drm[drm]['LA_URL'];
                    source['drm'] = {};
                    source.drm[drm] = { 'LA_URL': licenceUrl };
                }

                if (!source) {
                    source[manifestType] = noDrmSource[manifestType];
                }

                player.load(source).catch(function (error) {
                    console.log(error);
                });
            }

            function loadPlayerOnEnter(keyEvent) {
                if (keyEvent.keyCode === 13) {
                    loadPlayerFromControls();
                }
            }

            function loadPlayerFromControls() {
                var manifestInput = document.querySelector('#manifest-in').value;
                var licenceInput = document.querySelector('#licence-in').value;

                var drmSystem = document.querySelector('#available-drm-systems').options;
                drmSystem = drmSystem[drmSystem.selectedIndex].value;

                var manifestType = document.querySelector('#available-manifest-type').options;
                manifestType = manifestType[manifestType.selectedIndex].value;

                if (manifestInput && manifestInput !== '' && !checkIsUrlValid(manifestInput, 'Manifest URL')) {
                    return;
                }
                if (licenceInput && licenceInput !== '' && !checkIsUrlValid(licenceInput, 'License URL')) {
                    return;
                }

                setupPlayer(drmSystem, manifestInput, licenceInput, manifestType);
            }

            /**
             * retrieves an array containing all DRM systems supported by the current player instance inside the current browser
             *
             * @param {boolean} [initial=false]
             */
            function getSupportedDRMSystem(initial) {
                initial = initial || false;

                var retVal = [];

                return player.getSupportedDRM().then(function (drmSystem) {
                    drmSystem.forEach(function (element) {
                        var match = keySystems.wiseplay.find(function (obj) {
                            return obj === element;
                        }) ? 'wiseplay' : undefined;
                        console.log("support "+element);
                        // if (!match) {
                        //   keySystems.widevine.find(function (obj) {
                        //     return obj === element;
                        //   }) ? console.log("support widevine") : null;
                        // }
                        // if (!match) {
                        //   keySystems.playready.find(function (obj) {
                        //     return obj === element;
                        //   }) ? console.log('playready') : undefined;
                        // }
                        // if (!match) {
                        //   keySystems.fairplay.find(function (obj) {
                        //     return obj === element;
                        //   }) ? console.log('fairplay') : undefined;
                        // }
                        if (match) {
                            retVal.push(match);
                        }
                    });

                    // udpate the available DRM systems on the page before continuing
                    if (initial) {
                        var selectBox = document.querySelector('#available-drm-systems');
                        retVal.forEach(function (element) {
                            var newChild = document.createElement('OPTION');
                            newChild.value = element;
                            newChild.textContent = element;
                            selectBox.appendChild(newChild);
                        });
                        if (retVal.length > 0) {
                            selectBox.value = retVal[0];
                        }
                    }
                });
            }



            function checkIsUrlValid(url, urlPurpose) {
                if (url === null || url == undefined || url === '') {
                    console.error(urlPurpose + ' is not defined.');
                    return false;
                }
                if (typeof url !== 'string') {
                    console.error(urlPurpose + ' is not a string');
                    return false;
                }
                // check if url is abolute
                if (!/^https?:\/\/|^\/\//i.test(url)) {
                    console.error(urlPurpose + ' has to be absolute');
                    return false;
                }

                return true;
            }

            function supportedMediaSources() {
                var hasMediaSource, hasWebKitMediaSource;
                var mediaTypes = [
                    'video/mp4; codecs="avc1.42c00d"',
                    'video/mp4; codecs="ec-3"',
                    'video/webm; codecs="vorbis,vp8"',
                    'video/mp2t; codecs="avc1.42E01E,mp4a.40.2"'
                ];

                var supportedMediaTypes = {};
                if ('MediaSource' in window) {
                    if (window.MediaSource) {
                        hasMediaSource = true;
                    }
                }

                if ('WebKitMediaSource' in window) {
                    if (window.WebKitMediaSource) {
                        hasWebKitMediaSource = true;
                    }
                }

                for (var type in mediaTypes) {
                    if (hasMediaSource) {
                        supportedMediaTypes[mediaTypes[type]] = MediaSource.isTypeSupported(mediaTypes[type]);
                    } else if (hasWebKitMediaSource) {
                        supportedMediaTypes[mediaTypes[type]] = WebKitMediaSource.isTypeSupported(mediaTypes[type]);
                    }
                }
                return supportedMediaTypes;
            }

            function insertMseSupportList() {
                var supported = false;
                var list = supportedMediaSources();
                var statusEl = document.getElementById('mse-supported');
                var listEl = document.getElementById('mse-list');

                Object.keys(list).forEach(function (key) {
                    var li = document.createElement('li');
                    var span = document.createElement('span');
                    span.innerText = key;
                    li.classList.add(list[key] ? 'supported' : 'unsupported');
                    supported = !supported ? list[key] : supported;
                    li.appendChild(span);
                    listEl.appendChild(li);
                });

                if (supported) {
                    statusEl.classList.add('yes');
                    statusEl.innerText = 'supported';
                } else {
                    listEl.classList.add('no');
                    statusEl.innerText = 'not supported';
                }
            }

            function insertEmeSupportList() {
                var list = {
                    widevine: false,
                    playready: false,
                    primetime: false,
                    fairplay: false
                };

                var supported = false;
                var listEl = document.getElementById('eme-list');
                var statusEl = document.getElementById('eme-supported');

                player.getSupportedDRM().then(function (drmSystems) {
                    drmSystems.forEach(function (drm) {
                        Object.keys(keySystems).forEach(function (key) {
                            if (keySystems[key].indexOf(drm) !== -1) {
                                list[key] = true;
                                supported = true;
                            }
                        });
                    });

                    Object.keys(list).forEach(function (key) {
                        var li = document.createElement('li');
                        var span = document.createElement('span');
                        span.innerText = key;

                        li.classList.add(list[key] ? 'supported' : 'unsupported');
                        li.appendChild(span);
                        listEl.appendChild(li);
                    });

                    if (supported) {
                        statusEl.classList.add('yes');
                        statusEl.innerText = 'supported';
                    } else {
                        listEl.classList.add('no');
                        statusEl.innerText = 'not supported';
                    }
                });
            }

            function setManifestType() {
                var browser = getBrowser();

                if (browser === BROWSER.IE || browser === BROWSER.EDGE) {
                    document.querySelector('#available-manifest-type').selectedIndex = 2;
                }
                if (browser === BROWSER.SAFARI) {
                    document.querySelector('#available-manifest-type').selectedIndex = 1;
                }
            }

            getSupportedDRMSystem(true).then(function () {

                setManifestType();
                // insertMseSupportList();
                // insertEmeSupportList();
                loadPlayerFromControls();

                document.querySelector('#load-btn').addEventListener('click', loadPlayerFromControls);
                document.querySelector('#licence-in').addEventListener('keyup', loadPlayerOnEnter);
                document.querySelector('#manifest-in').addEventListener('keyup', loadPlayerOnEnter);
            });
        })();

    </script>
<!--    <script  type="text/css" src="css/style.css"></script>-->

</div>